"use strict";function fixInvalidCharactersfixInvalidCharacters(noteList){for(var accentMap={"á":"a","é":"e","í":"i","ó":"o","ú":"u","ñ":"n"},j=0;j<noteList.length;j++){for(var ret="",i=0;i<noteList[j].curso.length;i++)ret+=accentMap[noteList[j].curso.charAt(i)]||noteList[j].curso.charAt(i);noteList[j].curso=ret}return ret}function getBase64Image(img){var canvas=document.createElement("canvas");if(void 0!==img){canvas.width=img.width,canvas.height=img.height;var ctx=canvas.getContext("2d");ctx.drawImage(img,0,0)}var dataURL=canvas.toDataURL("image/jpeg");return dataURL}var ApplicationConfiguration=function(){var applicationModuleName="expedienteestudiantil",applicationModuleVendorDependencies=["ngResource","ngCookies","ngAnimate","ngTouch","ngSanitize","ui.router","ui.bootstrap","ui.utils","angularFileUpload","ngGrid"],registerModule=function(moduleName,dependencies){angular.module(moduleName,dependencies||[]),angular.module(applicationModuleName).requires.push(moduleName)};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function($locationProvider){$locationProvider.hashPrefix("!")}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("encargados"),ApplicationConfiguration.registerModule("estudiantes"),ApplicationConfiguration.registerModule("logros-academicos"),ApplicationConfiguration.registerModule("notas"),ApplicationConfiguration.registerModule("users"),angular.module("core").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("home",{url:"/",templateUrl:"modules/core/views/home.client.view.html"})}]),angular.module("core").controller("HeaderController",["$scope","Authentication","Menus",function($scope,Authentication,Menus){$scope.authentication=Authentication,$scope.isCollapsed=!1,$scope.menu=Menus.getMenu("topbar"),$scope.toggleCollapsibleMenu=function(){$scope.isCollapsed=!$scope.isCollapsed},$scope.$on("$stateChangeSuccess",function(){$scope.isCollapsed=!1})}]),angular.module("core").controller("HomeController",["$scope","Authentication",function($scope,Authentication){$scope.authentication=Authentication}]),angular.module("core").service("Menus",[function(){this.defaultRoles=["*"],this.menus={};var shouldRender=function(user){if(!user)return this.isPublic;if(~this.roles.indexOf("*"))return!0;for(var userRoleIndex in user.roles)for(var roleIndex in this.roles)if(this.roles[roleIndex]===user.roles[userRoleIndex])return!0;return!1};this.validateMenuExistance=function(menuId){if(menuId&&menuId.length){if(this.menus[menuId])return!0;throw new Error("Menu does not exists")}throw new Error("MenuId was not provided")},this.getMenu=function(menuId){return this.validateMenuExistance(menuId),this.menus[menuId]},this.addMenu=function(menuId,isPublic,roles){return this.menus[menuId]={isPublic:isPublic||!1,roles:roles||this.defaultRoles,items:[],shouldRender:shouldRender},this.menus[menuId]},this.removeMenu=function(menuId){this.validateMenuExistance(menuId),delete this.menus[menuId]},this.addMenuItem=function(menuId,menuItemTitle,menuItemURL,menuItemType,menuItemUIRoute,isPublic,roles,position){return this.validateMenuExistance(menuId),this.menus[menuId].items.push({title:menuItemTitle,link:menuItemURL,menuItemType:menuItemType||"item",menuItemClass:menuItemType,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:null===isPublic||"undefined"==typeof isPublic?this.menus[menuId].isPublic:isPublic,roles:null===roles||"undefined"==typeof roles?this.menus[menuId].roles:roles,position:position||0,items:[],shouldRender:shouldRender}),this.menus[menuId]},this.addSubMenuItem=function(menuId,rootMenuItemURL,menuItemTitle,menuItemURL,menuItemUIRoute,isPublic,roles,position){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===rootMenuItemURL&&this.menus[menuId].items[itemIndex].items.push({title:menuItemTitle,link:menuItemURL,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:null===isPublic||"undefined"==typeof isPublic?this.menus[menuId].items[itemIndex].isPublic:isPublic,roles:null===roles||"undefined"==typeof roles?this.menus[menuId].items[itemIndex].roles:roles,position:position||0,shouldRender:shouldRender});return this.menus[menuId]},this.removeMenuItem=function(menuId,menuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===menuItemURL&&this.menus[menuId].items.splice(itemIndex,1);return this.menus[menuId]},this.removeSubMenuItem=function(menuId,submenuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)for(var subitemIndex in this.menus[menuId].items[itemIndex].items)this.menus[menuId].items[itemIndex].items[subitemIndex].link===submenuItemURL&&this.menus[menuId].items[itemIndex].items.splice(subitemIndex,1);return this.menus[menuId]},this.addMenu("topbar",!0)}]),angular.module("encargados").run(["Menus",function(Menus){}]),angular.module("encargados").config(["$stateProvider",function($stateProvider){$stateProvider.state("listEncargados",{url:"/encargados/:estudianteId/:cedulaEstudiante",templateUrl:"modules/encargados/views/list-encargados.client.view.html"}).state("createEncargado",{url:"/encargados/create/:estudianteId/:cedulaEstudiante",templateUrl:"modules/encargados/views/create-encargado.client.view.html"}).state("viewEncargado",{url:"/encargados/:estudianteId/:cedulaEstudiante/:encargadoId",templateUrl:"modules/encargados/views/view-encargado.client.view.html"}).state("editEncargado",{url:"/encargados/:estudianteId/:cedulaEstudiante/:encargadoId/edit",templateUrl:"modules/encargados/views/edit-encargado.client.view.html"})}]),angular.module("encargados").controller("EncargadosController",["$scope","$stateParams","$location","Authentication","Encargados","GetEncargado","Utility",function($scope,$stateParams,$location,Authentication,Encargados,GetEncargado,Utility){$scope.authentication=Authentication,$scope.estudiante="",$scope.name="",$scope.primer_apellido="",$scope.segundo_apellido="",$scope.cedula="",$scope.parentesco="",$scope.ocupacion="",$scope.estado_civil="",$scope.nacionalidad="",$scope.telefono="",$scope.correo="",$scope.direccion="",$scope.idEstudianteUrl="",$scope.cedulaEstudianteUrl="",$scope.create=function(){console.log($scope.parentesco);var encargado=new Encargados({estudiante:$stateParams.cedulaEstudiante,name:$scope.name,primer_apellido:$scope.primer_apellido,segundo_apellido:$scope.segundo_apellido,cedula:$scope.cedula,parentesco:$scope.parentesco.relationship,ocupacion:$scope.ocupacion,estado_civil:$scope.estado_civil,nacionalidad:$scope.nacionalidad,telefono:$scope.telefono,correo:$scope.correo,direccion:$scope.direccion});$scope.cedula=$stateParams.cedulaEstudiante,$scope.idEtudianteUrl=$stateParams.estudianteId,$scope.encargadosE=GetEncargado.query({cedula:$scope.cedula}),$scope.encargadosE.$promise.then(function(){$scope.encargadosE.length<2?encargado.$save(function(response){$location.path("estudiantes/"+$stateParams.estudianteId),$scope.name=""},function(errorResponse){$scope.error=errorResponse.data.message}):$scope.error="Ya hay más de dos encargados"})},$scope.remove=function(encargado){if(encargado){encargado.$remove();for(var i in $scope.encargados)$scope.encargados[i]===encargado&&$scope.encargados.splice(i,1)}else $scope.encargado.$remove(function(){$location.path("encargados/"+$stateParams.estudianteId+"/"+$stateParams.cedulaEstudiante)})},$scope.update=function(){var encargado=$scope.encargado;encargado.parentesco=$scope.parentesco.relationship,encargado.$update(function(){$location.path("encargados/"+$stateParams.estudianteId+"/"+$stateParams.cedulaEstudiante+"/"+encargado._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){$scope.encargados=Encargados.query()},$scope.findByEstudiante=function(){$scope.cedula=$stateParams.cedulaEstudiante,$scope.estudianteID=$stateParams.estudianteId,$scope.encargadosE=GetEncargado.query({cedula:$scope.cedula})},$scope.findOne=function(){$scope.cedulaEstudianteUrl=$stateParams.cedulaEstudiante,$scope.idEstudianteUrl=$stateParams.estudianteId,$scope.encargado=Encargados.get({encargadoId:$stateParams.encargadoId}),$scope.encargado.$promise.then(function(estudiante){$scope.parentesco=$scope.setParentescoComboBox(estudiante.parentesco)})},$scope.relationshipStudentList=Utility.getRelationshipList(),$scope.parentesco=$scope.relationshipStudentList[0],$scope.setParentescoComboBox=function(parentesco){for(var i=0;i<$scope.relationshipStudentList.length;i++)if($scope.relationshipStudentList[i].relationship===parentesco)return $scope.relationshipStudentList[i]}}]),angular.module("encargados").factory("Encargados",["$resource",function($resource){return $resource("encargados/:encargadoId",{encargadoId:"@_id"},{update:{method:"PUT"}})}]),angular.module("encargados").factory("GetEncargado",["$resource",function($resource){return $resource("/encargados/estudiante/:cedula",{cedula:"@cedula"},{update:{method:"GET"}})}]),angular.module("encargados").service("Utility",[function(){this.getRelationshipList=function(){return[{relationship:"Padre"},{relationship:"Madre"},{relationship:"Encargado Legal"}]}}]),angular.module("estudiantes").run(["Menus",function(Menus){Menus.addMenuItem("topbar","Estudiantes","estudiantes","dropdown","/estudiantes(/create)?",!0),Menus.addSubMenuItem("topbar","estudiantes","Insertar Estudiante","estudiantes/create",!0),Menus.addSubMenuItem("topbar","estudiantes","Mostrar Estudiantes en Admisión","estudiantes_en_admicion",!0),Menus.addSubMenuItem("topbar","estudiantes","Mostrar Estudiantes Admitidos","estudiantes_admitidos",!0),Menus.addSubMenuItem("topbar","estudiantes","Consultas de Estudiantes","consultas_estudiantes/",!0),Menus.addSubMenuItem("topbar","estudiantes","Reportes de Estudiantes","reportes_estudiantes/",!0)}]),angular.module("estudiantes").config(["$stateProvider",function($stateProvider){$stateProvider.state("listEstudiantesEnAdmicion",{url:"/estudiantes_en_admicion",templateUrl:"modules/estudiantes/views/list-estudiantes-en-admicion.client.view.html"}).state("listEstudiantesAdmitidos",{url:"/estudiantes_admitidos",templateUrl:"modules/estudiantes/views/list-estudiantes-admitidos.client.view.html"}).state("createEstudiante",{url:"/estudiantes/create",templateUrl:"modules/estudiantes/views/create-estudiante.client.view.html"}).state("viewEstudiante",{url:"/estudiantes/:estudianteId",templateUrl:"modules/estudiantes/views/view-estudiante.client.view.html"}).state("editEstudiante",{url:"/estudiantes/:estudianteId/edit",templateUrl:"modules/estudiantes/views/edit-estudiante.client.view.html"}).state("notasccEstudiante",{url:"/estudiantes/:estudianteId/archivosadjuntos",templateUrl:"modules/estudiantes/views/archivos-adjuntos.view.html"}).state("datosEstudiante",{url:"/estudiantes/:estudianteId/notas_c_c",templateUrl:"modules/estudiantes/views/notas-colegio-cientifico.view.html"}).state("consultasEstudiantes",{url:"/consultas_estudiantes/",templateUrl:"modules/estudiantes/views/consultas-estudiantes.view.html"}).state("reportesEstudiantes",{url:"/reportes_estudiantes/",templateUrl:"modules/estudiantes/views/repotes-estudiantes.view.html"})}]),angular.module("estudiantes").controller("EstudiantesController",["$scope","$stateParams","$location","$filter","$http","$sce","Authentication","Estudiantes","$upload","Notas","GetNotas","GetAdmitidos","Decimo","Undecimo","Nacionalidad","Reports",function($scope,$stateParams,$location,$filter,$http,$sce,Authentication,Estudiantes,$upload,Notas,GetNotas,GetAdmitidos,Decimo,Undecimo,Nacionalidad,Reports){function createReport(){var reporte=$scope.reporte,grade=$scope.grade_report,serviceReport=Reports;$scope.visibl=!1,$scope.show=!0,$scope.grade_visible=!0,1===grade.grade_val?serviceReport.studentsList=Decimo.query():2===grade.grade_val&&(serviceReport.studentsList=Undecimo.query()),serviceReport.studentsList.$promise.then(function(students){var pdfReport;1===reporte.val?pdfReport=serviceReport.attendanceListReport(students,grade.grade_opt.toUpperCase()):2===reporte.val?pdfReport=serviceReport.personalInfoListReport(students):3===reporte.val?pdfReport=serviceReport.scienceForBachelorListReport(students,grade.grade_opt.toUpperCase()):4===reporte.val?pdfReport=serviceReport.emailListReport(students,grade.grade_opt.toUpperCase()):5===reporte.val?pdfReport=serviceReport.scienceForBachelorChoiceListReport(students):6===reporte.val?pdfReport=serviceReport.StudentsForLibraryListReport(students,grade.grade_opt.toUpperCase()):7===reporte.val?pdfReport=serviceReport.OlympicsParticipationListReport(students,grade.grade_opt.toUpperCase()):8===reporte.val&&($scope.grade_visible=!1,$scope.visibl=!0,$scope.show=!1),void 0!==pdfReport&&pdfReport.Data.length>0&&$scope.generatePDF(pdfReport)})}$scope.authentication=Authentication,$scope.options=$http.get("codigo-postal.json").then(function(data){$scope.options=data.data,$scope.provincia=$scope.options[0],$scope.canton=$scope.provincia.cantones[0],$scope.distrito=$scope.canton.distritos[0]}),$scope.high_schools_list=$http.get("colegios-procedencia.json").then(function(data){$scope.high_schools_list=data.data,$scope.colegio_procedencia=$scope.high_schools_list[0]}),$scope.sexos=[{nombre:"Masculino"},{nombre:"Femenino"}],$scope.adecuaciones=[{nombre:"Tiene"},{nombre:"No tiene"}],$scope.consultas=[{nombre:"Nombre"},{nombre:"Cedula"},{nombre:"Colegio de Procedencia"}],$scope.consultas_genero=[{sexo:"Masculino"},{sexo:"Femenino"},{sexo:"Ambos"}],$scope.consultas_grado=[{grado:"Décimo"},{grado:"Undécimo"},{grado:"Décimo y Undécimo"}],$scope.consultas_estado=[{estado:"Todos"},{estado:"Egresado"},{estado:"Trasladado"}],$scope.consulta=$scope.consultas[0],$scope.consulta_sexo=$scope.consultas_genero[0],$scope.consulta_grado=$scope.consultas_grado[0],$scope.consulta_estado=$scope.consultas_estado[0],$scope.sexo=$scope.sexos[0],$scope.adSignificativa=$scope.adecuaciones[0],$scope.adNoSignificativa=$scope.adecuaciones[0],$scope.foto="",$scope.editable=!1,$scope.selectedFile=[],$scope.selected_certificacion_nacimiento=[],$scope.selected_certificacion_notas=[],$scope.selected_inf_hogar=[],$scope.selected_vacunas=[],$scope.anno_ingreso=0,$scope.provincia_change=function(){$scope.canton=$scope.provincia.cantones[0],$scope.distrito=$scope.canton.distritos[0]},$scope.canton_change=function(){$scope.distrito=$scope.canton.distritos[0]},$scope.onFileSelect=function($files){$files!==[]&&($scope.selectedFile=$files)},$scope.on_select_cer_nacimiento=function($files){$files!==[]&&($scope.selected_certificacion_nacimiento=$files)},$scope.on_select_cer_notas=function($files){$files!==[]&&($scope.selected_certificacion_notas=$files)},$scope.on_select_infor_hogar=function($files){$files!==[]&&($scope.selected_inf_hogar=$files)},$scope.on_select_tarje_vacunas=function($files){$files!==[]&&($scope.selected_vacunas=$files)},$scope.$watch("anno_ingreso",function(){$scope.anno_ingreso>(new Date).getFullYear()?$scope.anno_ingreso_error_mayor_actual=!0:$scope.anno_ingreso_error_mayor_actual=!1}),$scope.create=function(){function insertarEstudiante(){var graduado=0;graduado=$scope.graduado;var admitido=0;if($scope.anno_ingreso>(new Date).getFullYear())return void($scope.anno_ingreso_error=!0);admitido=$scope.anno_ingreso;var estudiante=new Estudiantes({name:$scope.name,primer_apellido:$scope.primer_apellido,segundo_apellido:$scope.segundo_apellido,nacionalidad:$scope.nacionalidad,sexo:$scope.sexo.nombre,fecha_de_nacimiento:$scope.fecha_de_nacimiento,telefono_casa:$scope.telefono_casa,celular:$scope.celular,correo:$scope.correo,provincia:$scope.provincia.nombre,canton:$scope.canton.nombre,distrito:$scope.distrito.nombre,barrio:$scope.barrio,direccion_exacta:$scope.direccion_exacta,admitido:admitido,foto:$scope.foto,anno_ingreso:$scope.anno_ingreso,colegio_procedencia:$scope.colegio_procedencia.name,adecuacion_sig:$scope.adecuacion_sig,adecuacion_nsig:$scope.adecuacion_nsig,graduado:graduado});estudiante.$save(function(response){for(var i=0;i<$scope.notas_setimo_octavo_noveno.length;i++){var notaS=new Notas({cedula_estudiante:$scope.nacionalidad,grado:"septimo",curso:$scope.notas_setimo_octavo_noveno[i].curso,nota:$scope.notas_setimo_octavo_noveno[i].nota_setimo,anno:estudiante.anno_ingreso-3,semestre:0}),notaO=new Notas({cedula_estudiante:$scope.nacionalidad,grado:"octavo",curso:$scope.notas_setimo_octavo_noveno[i].curso,nota:$scope.notas_setimo_octavo_noveno[i].nota_octavo,anno:estudiante.anno_ingreso-2,semestre:0}),notaNPT=new Notas({cedula_estudiante:$scope.nacionalidad,grado:"noveno",curso:$scope.notas_setimo_octavo_noveno[i].curso,nota:$scope.notas_setimo_octavo_noveno[i].nota_noveno_primer_trimestre,anno:estudiante.anno_ingreso-1,semestre:1}),notaNST=new Notas({cedula_estudiante:$scope.nacionalidad,grado:"noveno",curso:$scope.notas_setimo_octavo_noveno[i].curso,nota:$scope.notas_setimo_octavo_noveno[i].nota_noveno_segundo_trimestre,anno:estudiante.anno_ingreso-1,semestre:2});notaS.$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message}),notaO.$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message}),notaNPT.$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message}),notaNST.$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message})}for(var j=0;j<$scope.notas_decimo_undecimo.length;j++){var notaD1=new Notas({cedula_estudiante:$scope.nacionalidad,grado:"decimo",curso:$scope.notas_decimo_undecimo[j].curso,nota:$scope.notas_decimo_undecimo[j].nota_decimo_primer_semestre,anno:estudiante.anno_ingreso,semestre:1}),notaD2=new Notas({cedula_estudiante:$scope.nacionalidad,grado:"decimo",curso:$scope.notas_decimo_undecimo[j].curso,nota:$scope.notas_decimo_undecimo[j].nota_decimo_segundo_semestre,anno:estudiante.anno_ingreso,semestre:2}),notaU1=new Notas({cedula_estudiante:$scope.nacionalidad,grado:"undecimo",curso:$scope.notas_decimo_undecimo[j].curso,nota:$scope.notas_decimo_undecimo[j].nota_undecimo_primer_semestre,anno:estudiante.anno_ingreso+1,semestre:1}),notaU2=new Notas({cedula_estudiante:$scope.nacionalidad,grado:"undecimo",curso:$scope.notas_decimo_undecimo[j].curso,nota:$scope.notas_decimo_undecimo[j].nota_undecimo_segundo_semestre,anno:estudiante.anno_ingreso+1,semestre:2});notaD1.$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message}),notaD2.$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message}),notaU1.$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message}),notaU2.$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message})}$location.path("estudiantes/"+response._id)},function(errorResponse){$scope.error=errorResponse.data.message})}var file=$scope.selectedFile[0];$scope.upload=$upload.upload({url:"/upload",method:"POST",file:file}).success(function(data){$scope.foto=data.name,insertarEstudiante()})},$scope.remove=function(estudiante){if(estudiante){estudiante.$remove();for(var i in $scope.estudiantes)$scope.estudiantes[i]===estudiante&&$scope.estudiantes.splice(i,1)}else{$scope.estudiante.$remove(function(){$location.path("estudiantes")});var notas=$scope.notas;angular.forEach(notas,function(nota){Notas.remove({notaId:nota._id},nota)})}},$scope.update=function(){var file=$scope.selectedFile[0];$scope.upload=$upload.upload({url:"/upload",method:"POST",file:file}).success(function(data){$scope.foto=data.name,$scope.updateEstudiantes()})},$scope.updateEstudiantes=function(){var estudiante=$scope.estudiante;estudiante.foto=$scope.foto,"Masculino"===$scope.sexo.nombre?estudiante.sexo=!0:estudiante.sexo=!1,"Tiene"===$scope.adSignificativa.nombre?estudiante.adSignificativa=!0:estudiante.adSignificativa=!1,"Tiene"===$scope.adNoSignificativa.nombre?estudiante.adNoSignificativa=!0:estudiante.adNoSignificativa=!1,estudiante.provincia=$scope.provincia.nombre,estudiante.canton=$scope.canton.nombre,estudiante.distrito=$scope.distrito.nombre,estudiante.colegio_procedencia=$scope.colegio_procedencia.name,estudiante.$update(function(){$location.path("estudiantes/"+estudiante._id)},function(errorResponse){$scope.error=errorResponse.data.message});var notas=$scope.notas;angular.forEach(notas,function(nota){for(var i=0;i<$scope.notas_setimo_octavo_noveno.length;i++)"septimo"===nota.grado&&$scope.notas_setimo_octavo_noveno[i].curso===nota.curso?nota.nota=$scope.notas_setimo_octavo_noveno[i].nota_setimo:"octavo"===nota.grado&&$scope.notas_setimo_octavo_noveno[i].curso===nota.curso?nota.nota=$scope.notas_setimo_octavo_noveno[i].nota_octavo:"noveno"===nota.grado&&$scope.notas_setimo_octavo_noveno[i].curso===nota.curso&&(1===nota.semestre?nota.nota=$scope.notas_setimo_octavo_noveno[i].nota_noveno_primer_trimestre:2===nota.semestre&&(nota.nota=$scope.notas_setimo_octavo_noveno[i].nota_noveno_segundo_trimestre));Notas.update({notaId:nota._id},nota)})},$scope.estudiantes=[],$scope.find=function(matriculado){$scope.estudiantes=Estudiantes.query(),$scope.ngGridEstudiantes(matriculado)},$scope.admitidos=function(admitido){$scope.estudiantes=GetAdmitidos.query({admitido:admitido}),$scope.ngGridEstudiantes(admitido)},$scope.findOne=function(edit){$scope.estudiante=Estudiantes.get({estudianteId:$stateParams.estudianteId}),$scope.notas_septimo=[],$scope.notas_octavo=[],$scope.notas_noveno=[],$scope.notas_setimo_octavo_noveno=[],$scope.editable=edit,$scope.estudiante.$promise.then(function(estudiante){if($scope.sexo=$scope.sexos[$scope.find($scope.sexos,$scope.estudiante.sexo,0)],edit){$scope.adecuaciones[0].nombre===$scope.estudiante.adecuacion_sig?$scope.adSignificativa=$scope.adecuaciones[0]:$scope.adSignificativa=$scope.adecuaciones[1],$scope.adecuaciones[0].nombre===$scope.estudiante.adecuacion_nsig?$scope.adNoSignificativa=$scope.adecuaciones[0]:$scope.adNoSignificativa=$scope.adecuaciones[1];var arr=$scope.findprovincia($scope.estudiante.provincia,$scope.estudiante.canton,$scope.estudiante.distrito);$scope.provincia=$scope.options[arr[0]],$scope.canton=$scope.options[arr[0]].cantones[arr[1]],$scope.distrito=$scope.options[arr[0]].cantones[arr[1]].distritos[arr[2]],$scope.colegio_procedencia=$scope.setColegioProcedenciaComboBox($scope.estudiante.colegio_procedencia)}$scope.notas=GetNotas.query({cedula_estudiante:estudiante.nacionalidad}),$scope.notas.$promise.then(function(notas){var temporalNoteRegister=[];angular.forEach(notas,function(nota){"septimo"===nota.grado?temporalNoteRegister.push({materia:nota.curso,grado:nota.grado,calificacion:nota.nota}):"octavo"===nota.grado?temporalNoteRegister.push({materia:nota.curso,grado:nota.grado,calificacion:nota.nota}):"noveno"===nota.grado&&temporalNoteRegister.push({materia:nota.curso,grado:nota.grado,calificacion:nota.nota,semestre:nota.semestre})});for(var cursos_checked=[],i=0;i<temporalNoteRegister.length;i++){var curso=temporalNoteRegister[i].materia,setimo=0,octavo=0,noveno_primer_trimestre=0,noveno_segundo_trimestre=0;if(-1===cursos_checked.indexOf(curso)){for(var j=0;j<temporalNoteRegister.length;j++)temporalNoteRegister[j].materia===curso&&("septimo"===temporalNoteRegister[j].grado?setimo=temporalNoteRegister[j].calificacion:"octavo"===temporalNoteRegister[j].grado?octavo=temporalNoteRegister[j].calificacion:"noveno"===temporalNoteRegister[j].grado&&(1===temporalNoteRegister[j].semestre?noveno_primer_trimestre=temporalNoteRegister[j].calificacion:2===temporalNoteRegister[j].semestre&&(noveno_segundo_trimestre=temporalNoteRegister[j].calificacion)));cursos_checked.push(curso),$scope.notas_setimo_octavo_noveno.push({curso:curso,nota_setimo:setimo,nota_octavo:octavo,nota_noveno_primer_trimestre:noveno_primer_trimestre,nota_noveno_segundo_trimestre:noveno_segundo_trimestre})}}},function(error){console.log("Failed: "+error)})},function(error){console.log("Failed: "+error)}),$scope.initGridOptions()},$scope.find=function(arr,obj,val){var com="";0===val?com=obj?"Masculino":"Femenino":1===val&&(com=obj?"Tiene":"No Tiene");for(var i=0;i<arr.length;i++)if(arr[i].nombre===com)return i},$scope.findprovincia=function(prov,can,dis){var retorno=[],arr=$scope.options,i=0;for(i;i<arr.length;i++)if(arr[i].nombre===prov){var j=0;for(j;j<arr[i].cantones.length;j++)if(arr[i].cantones[j].nombre===can){var g=0;for(g;g<arr[i].cantones[j].distritos.length;g++)if(arr[i].cantones[j].distritos[g].nombre===dis)return retorno.push(i),retorno.push(j),retorno.push(g),retorno}}},$scope.setColegioProcedenciaComboBox=function(colegio){for(var i=0;i<$scope.high_schools_list.length;i++)if($scope.high_schools_list[i].name===colegio)return $scope.high_schools_list[i]},$scope.initNotas=function(){$scope.estudiante;$scope.editable=!0,$scope.notas_setimo_octavo_noveno=[{curso:"Inglés",nota_setimo:0,nota_octavo:0,nota_noveno_primer_trimestre:0,nota_noveno_segundo_trimestre:0},{curso:"Matemática",nota_setimo:0,nota_octavo:0,nota_noveno_primer_trimestre:0,nota_noveno_segundo_trimestre:0},{curso:"Ciencias",nota_setimo:0,nota_octavo:0,nota_noveno_primer_trimestre:0,nota_noveno_segundo_trimestre:0},{curso:"Cívica",nota_setimo:0,nota_octavo:0,nota_noveno_primer_trimestre:0,nota_noveno_segundo_trimestre:0},{curso:"Español",nota_setimo:0,nota_octavo:0,nota_noveno_primer_trimestre:0,nota_noveno_segundo_trimestre:0},{curso:"Estudios Sociales",nota_setimo:0,nota_octavo:0,nota_noveno_primer_trimestre:0,nota_noveno_segundo_trimestre:0},{curso:"Conducta",nota_setimo:0,nota_octavo:0,nota_noveno_primer_trimestre:0,nota_noveno_segundo_trimestre:0},{curso:"Promedio",nota_setimo:0,nota_octavo:0,nota_noveno_primer_trimestre:0,nota_noveno_segundo_trimestre:0}],$scope.notas_decimo_undecimo=[{curso:"Español",nota_decimo_primer_semestre:0,nota_decimo_segundo_semestre:0,nota_undecimo_primer_semestre:0,nota_undecimo_segundo_semestre:0},{curso:"Matemáticas",nota_decimo_primer_semestre:0,nota_decimo_segundo_semestre:0,nota_undecimo_primer_semestre:0,nota_undecimo_segundo_semestre:0},{curso:"Física",nota_decimo_primer_semestre:0,nota_decimo_segundo_semestre:0,nota_undecimo_primer_semestre:0,nota_undecimo_segundo_semestre:0},{curso:"Química",nota_decimo_primer_semestre:0,nota_decimo_segundo_semestre:0,nota_undecimo_primer_semestre:0,nota_undecimo_segundo_semestre:0},{curso:"Biología",nota_decimo_primer_semestre:0,nota_decimo_segundo_semestre:0,nota_undecimo_primer_semestre:0,nota_undecimo_segundo_semestre:0},{curso:"Biotecnología",nota_decimo_primer_semestre:0,nota_decimo_segundo_semestre:0,nota_undecimo_primer_semestre:0,nota_undecimo_segundo_semestre:0},{curso:"Computación",nota_decimo_primer_semestre:0,nota_decimo_segundo_semestre:0,nota_undecimo_primer_semestre:0,nota_undecimo_segundo_semestre:0},{curso:"Robótica",nota_decimo_primer_semestre:0,nota_decimo_segundo_semestre:0,nota_undecimo_primer_semestre:0,nota_undecimo_segundo_semestre:0},{curso:"Dibujo Técnico",nota_decimo_primer_semestre:0,nota_decimo_segundo_semestre:0,nota_undecimo_primer_semestre:0,nota_undecimo_segundo_semestre:0},{curso:"Inglés",nota_decimo_primer_semestre:0,nota_decimo_segundo_semestre:0,nota_undecimo_primer_semestre:0,nota_undecimo_segundo_semestre:0},{curso:"Investigación",nota_decimo_primer_semestre:0,nota_decimo_segundo_semestre:0,nota_undecimo_primer_semestre:0,nota_undecimo_segundo_semestre:0},{curso:"Historia",nota_decimo_primer_semestre:0,nota_decimo_segundo_semestre:0,nota_undecimo_primer_semestre:0,nota_undecimo_segundo_semestre:0},{curso:"Geografía",nota_decimo_primer_semestre:0,nota_decimo_segundo_semestre:0,nota_undecimo_primer_semestre:0,nota_undecimo_segundo_semestre:0},{curso:"Educ. Religiosa",nota_decimo_primer_semestre:0,nota_decimo_segundo_semestre:0,nota_undecimo_primer_semestre:0,nota_undecimo_segundo_semestre:0},{curso:"Educ. Cívica",nota_decimo_primer_semestre:0,nota_decimo_segundo_semestre:0,nota_undecimo_primer_semestre:0,nota_undecimo_segundo_semestre:0},{curso:"Educ. Física",nota_decimo_primer_semestre:0,nota_decimo_segundo_semestre:0,nota_undecimo_primer_semestre:0,nota_undecimo_segundo_semestre:0},{curso:"Matemática(PROF.)",nota_decimo_primer_semestre:0,nota_decimo_segundo_semestre:0,nota_undecimo_primer_semestre:0,nota_undecimo_segundo_semestre:0},{curso:"Física(PROF.)",nota_decimo_primer_semestre:0,nota_decimo_segundo_semestre:0,nota_undecimo_primer_semestre:0,nota_undecimo_segundo_semestre:0},{curso:"Química(PROF.)",nota_decimo_primer_semestre:0,nota_decimo_segundo_semestre:0,nota_undecimo_primer_semestre:0,nota_undecimo_segundo_semestre:0},{curso:"Biología(PROF.)",nota_decimo_primer_semestre:0,nota_decimo_segundo_semestre:0,nota_undecimo_primer_semestre:0,nota_undecimo_segundo_semestre:0},{curso:"Conducta",nota_decimo_primer_semestre:0,nota_decimo_segundo_semestre:0,nota_undecimo_primer_semestre:0,nota_undecimo_segundo_semestre:0},{curso:"Promedio",nota_decimo_primer_semestre:0,nota_decimo_segundo_semestre:0,nota_undecimo_primer_semestre:0,nota_undecimo_segundo_semestre:0}],$scope.initGridOptions()},$scope.initGridOptions=function(){$scope.gridOptionsSON=$scope.getGridOptionsNotasSON("notas_setimo_octavo_noveno"),$scope.gridOptionsDU=$scope.getGridOptionsNotasDU("notas_decimo_undecimo")},$scope.getGridOptionsNotasSON=function(data){var editCellTemplate='<input type="number" ng-class="\'colt\' + col.index"  min="1" max="100" ng-input="COL_FIELD" ng-model="COL_FIELD" >',width=125;return{data:data,enableCellSelection:!0,enableRowSelection:!1,enableCellEditOnFocus:$scope.editable,columnDefs:[{field:"curso",displayName:"Asignatura",enableCellEdit:!1},{field:"nota_setimo",displayName:"Notas de sétimo",enableCellEdit:$scope.editable,editableCellTemplate:editCellTemplate,cellClass:"grid-align",width:width,cellTemplate:"<div class=\"ngCellText\" ng-class=\"{'red' : row.getProperty('nota_setimo') < 70 && row.getProperty('nota_setimo') != 0, 'yellow' : row.getProperty('nota_setimo') >= 70 && row.getProperty('nota_setimo') < 85  && row.getProperty('nota_setimo') != 0, 'green' : row.getProperty('nota_setimo') >=85 && row.getProperty('nota_setimo') != 0  }\">{{ row.getProperty(col.field) }}</div>"},{field:"nota_octavo",displayName:"Notas de octavo",enableCellEdit:$scope.editable,editableCellTemplate:editCellTemplate,cellClass:"grid-align",width:width,cellTemplate:"<div class=\"ngCellText\" ng-class=\"{'red' : row.getProperty('nota_octavo') < 70 && row.getProperty('nota_octavo') != 0, 'yellow' : row.getProperty('nota_octavo') >= 70 && row.getProperty('nota_octavo') < 85  && row.getProperty('nota_octavo') != 0, 'green' : row.getProperty('nota_octavo') >=85 && row.getProperty('nota_octavo') != 0  }\">{{ row.getProperty(col.field) }}</div>"},{field:"nota_noveno_primer_trimestre",displayName:"I Trimestre",enableCellEdit:$scope.editable,editableCellTemplate:editCellTemplate,cellClass:"grid-align",width:width,cellTemplate:"<div class=\"ngCellText\" ng-class=\"{'red' : row.getProperty('nota_noveno_primer_trimestre') < 70 && row.getProperty('nota_noveno_primer_trimestre') != 0, 'yellow' : row.getProperty('nota_noveno_primer_trimestre') >= 70 && row.getProperty('nota_noveno_primer_trimestre') < 85  && row.getProperty('nota_noveno_primer_trimestre') != 0, 'green' : row.getProperty('nota_noveno_primer_trimestre') >=85 && row.getProperty('nota_noveno_primer_trimestre') != 0  }\">{{ row.getProperty(col.field) }}</div>"},{field:"nota_noveno_segundo_trimestre",displayName:"II Trimestre",enableCellEdit:$scope.editable,
editableCellTemplate:editCellTemplate,cellClass:"grid-align",width:width,cellTemplate:"<div class=\"ngCellText\" ng-class=\"{'red' : row.getProperty('nota_noveno_segundo_trimestre') < 70 && row.getProperty('nota_noveno_segundo_trimestre') != 0, 'yellow' : row.getProperty('nota_noveno_segundo_trimestre') >= 70 && row.getProperty('nota_noveno_segundo_trimestre') < 85  && row.getProperty('nota_noveno_segundo_trimestre') != 0, 'green' : row.getProperty('nota_noveno_segundo_trimestre') >=85 && row.getProperty('nota_noveno_segundo_trimestre') != 0  }\">{{ row.getProperty(col.field) }}</div>"}]}},$scope.getGridOptionsNotasDU=function(data){var width=120;return{data:data,enableCellSelection:!0,enableRowSelection:!1,enableCellEditOnFocus:$scope.editable,columnDefs:[{field:"curso",displayName:"Asignatura",enableCellEdit:!1},{field:"nota_decimo_primer_semestre",displayName:"I",enableCellEdit:$scope.editable,width:width,cellClass:"grid-align",editableCellTemplate:'<input type="number" ng-class="\'colt\' + col.index"  min="1" max="100" ng-input="COL_FIELD" ng-model="COL_FIELD" >',cellTemplate:"<div class=\"ngCellText\" ng-class=\"{'red' : row.getProperty('nota_decimo_primer_semestre') <70 && row.getProperty('nota_decimo_primer_semestre') != 0,   'green' : row.getProperty('nota_decimo_primer_semestre') >=70 && row.getProperty('nota_decimo_primer_semestre') != 0  }\">{{ row.getProperty(col.field) }}</div>"},{field:"nota_decimo_segundo_semestre",displayName:"II",enableCellEdit:$scope.editable,width:width,cellClass:"grid-align",editableCellTemplate:'<input type="number" ng-class="\'colt\' + col.index"  min="1" max="100" ng-input="COL_FIELD" ng-model="COL_FIELD" >',cellTemplate:"<div class=\"ngCellText\" ng-class=\"{'red' : row.getProperty('nota_decimo_segundo_semestre') <70 && row.getProperty('nota_decimo_segundo_semestre') != 0,   'green' : row.getProperty('nota_decimo_segundo_semestre') >=70 && row.getProperty('nota_decimo_segundo_semestre') != 0  }\">{{ row.getProperty(col.field) }}</div>"},{field:"nota_undecimo_primer_semestre",displayName:"I",enableCellEdit:$scope.editable,width:width,cellClass:"grid-align",editableCellTemplate:'<input type="number" ng-class="\'colt\' + col.index"  min="1" max="100" ng-input="COL_FIELD" ng-model="COL_FIELD" >',cellTemplate:"<div class=\"ngCellText\" ng-class=\"{'red' : row.getProperty('nota_undecimo_primer_semestre') <70 && row.getProperty('nota_undecimo_primer_semestre') != 0,   'green' : row.getProperty('nota_undecimo_primer_semestre') >=70 && row.getProperty('nota_undecimo_primer_semestre') != 0  }\">{{ row.getProperty(col.field) }}</div>"},{field:"nota_undecimo_segundo_semestre",displayName:"II",enableCellEdit:$scope.editable,width:width,cellClass:"grid-align",editableCellTemplate:'<input type="number" ng-class="\'colt\' + col.index"  min="1" max="100" ng-input="COL_FIELD" ng-model="COL_FIELD" >',cellTemplate:"<div class=\"ngCellText\" ng-class=\"{'red' : row.getProperty('nota_undecimo_segundo_semestre') <70 && row.getProperty('nota_undecimo_segundo_semestre') != 0,   'green' : row.getProperty('nota_undecimo_segundo_semestre') >=70 && row.getProperty('nota_undecimo_segundo_semestre') != 0  }\">{{ row.getProperty(col.field) }}</div>"}]}},$scope.notes_c_c=function(){$scope.notas_decimo_undecimo=[],$scope.editable=!0;var estudiante=Estudiantes.get({estudianteId:$stateParams.estudianteId});estudiante.$promise.then(function(estudiante){$scope.notas=GetNotas.query({cedula_estudiante:estudiante.nacionalidad}),$scope.notas.$promise.then(function(notas){var temporalNoteRegister=[];angular.forEach(notas,function(nota){"decimo"===nota.grado&&1===nota.semestre?temporalNoteRegister.push({materia:nota.curso,grado:nota.grado,calificacion:nota.nota,semestre:nota.semestre}):"decimo"===nota.grado&&2===nota.semestre?temporalNoteRegister.push({materia:nota.curso,grado:nota.grado,calificacion:nota.nota,semestre:nota.semestre}):"undecimo"===nota.grado&&1===nota.semestre?temporalNoteRegister.push({materia:nota.curso,grado:nota.grado,calificacion:nota.nota,semestre:nota.semestre}):"undecimo"===nota.grado&&2===nota.semestre&&temporalNoteRegister.push({materia:nota.curso,grado:nota.grado,calificacion:nota.nota,semestre:nota.semestre})});for(var cursos_checked=[],promedio_decimo=0,promedio_undecimo=0,i=0;i<temporalNoteRegister.length;i++){var curso=temporalNoteRegister[i].materia,decimo_primer_semestre=0,decimo_segundo_semestre=0,undecimo_primer_semestre=0,undecimo_segundo_semestre=0;if(-1===cursos_checked.indexOf(curso)){for(var j=0;j<temporalNoteRegister.length;j++)temporalNoteRegister[j].materia===curso&&("decimo"===temporalNoteRegister[j].grado&&1===temporalNoteRegister[j].semestre?decimo_primer_semestre=temporalNoteRegister[j].calificacion:"decimo"===temporalNoteRegister[j].grado&&2===temporalNoteRegister[j].semestre?decimo_segundo_semestre=temporalNoteRegister[j].calificacion:"undecimo"===temporalNoteRegister[j].grado&&1===temporalNoteRegister[j].semestre?undecimo_primer_semestre=temporalNoteRegister[j].calificacion:"undecimo"===temporalNoteRegister[j].grado&&2===temporalNoteRegister[j].semestre&&(undecimo_segundo_semestre=temporalNoteRegister[j].calificacion),"Promedio"===curso&&("decimo"===temporalNoteRegister[j].grado?promedio_decimo+=temporalNoteRegister[j].calificacion:promedio_undecimo+=temporalNoteRegister[j].calificacion));cursos_checked.push(curso),$scope.notas_decimo_undecimo.push({curso:curso,nota_decimo_primer_semestre:decimo_primer_semestre,nota_decimo_segundo_semestre:decimo_segundo_semestre,nota_undecimo_primer_semestre:undecimo_primer_semestre,nota_undecimo_segundo_semestre:undecimo_segundo_semestre})}}},function(error){console.log("Failed: "+error)})}),$scope.initGridOptions()},$scope.ngGridEstudiantes=function(matriculado){matriculado?$scope.gridOptionsList={data:"estudiantes",enableCellSelection:!0,enableRowSelection:!1,enableCellEditOnFocus:!1,columnDefs:[{field:"name",displayName:"Nombre"},{field:"nacionalidad",displayName:"Cédula"},{field:"admitido",displayName:"Admitido",cellTemplate:'<input type="checkbox" ng-model="row.entity.admitido">'},{field:"_id",displayName:"Ver",cellTemplate:'<a data-ng-href="#!/estudiantes/{{row.entity._id}}">ver</a>'}]}:$scope.gridOptionsList={data:"estudiantes",enableCellSelection:!0,enableRowSelection:!1,enableCellEditOnFocus:!1,columnDefs:[{field:"name",displayName:"Nombre"},{field:"nacionalidad",displayName:"Cédula"},{field:"anno_ingreso",displayName:"Año",cellTemplate:'<div class="ngCellText">{{row.getProperty(col.field) | anno}}</div>'},{field:"traladado",displayName:"Trasladar",cellTemplate:'<input type="checkbox" ng-model="row.entity.traladado">'},{field:"_id",displayName:"Ver",cellTemplate:'<a data-ng-href="#!/estudiantes/{{row.entity._id}}">ver</a>'}]}},$scope.calcularPromedio=function(){var promedio_decimo_primer_semestre=0,promedio_decimo_segundo_semestre=0,promedio_undecimo_primer_semestre=0,promedio_undecimo_segundo_semestre=0,promedio_row=0;angular.forEach($scope.notas_decimo_undecimo,function(nota){"Promedio"!==nota.curso?(promedio_decimo_primer_semestre+=nota.nota_decimo_primer_semestre,promedio_decimo_segundo_semestre+=nota.nota_decimo_segundo_semestre,promedio_undecimo_primer_semestre+=nota.nota_undecimo_primer_semestre,promedio_undecimo_segundo_semestre+=nota.nota_undecimo_segundo_semestre):"Promedio"===nota.curso&&(promedio_row=nota)}),promedio_decimo_primer_semestre=Math.round(promedio_decimo_primer_semestre/($scope.notas_decimo_undecimo.length-1)*100)/100,promedio_decimo_segundo_semestre=Math.round(promedio_decimo_segundo_semestre/($scope.notas_decimo_undecimo.length-1)*100)/100,promedio_undecimo_primer_semestre=Math.round(promedio_undecimo_primer_semestre/($scope.notas_decimo_undecimo.length-1)*100)/100,promedio_undecimo_segundo_semestre=Math.round(promedio_undecimo_segundo_semestre/($scope.notas_decimo_undecimo.length-1)*100)/100,promedio_row.nota_decimo_primer_semestre=promedio_decimo_primer_semestre,promedio_row.nota_decimo_segundo_semestre=promedio_decimo_segundo_semestre,promedio_row.nota_undecimo_primer_semestre=promedio_undecimo_primer_semestre,promedio_row.nota_undecimo_segundo_semestre=promedio_undecimo_segundo_semestre,$scope.tenth_annual_average=Math.round((promedio_decimo_primer_semestre+promedio_decimo_segundo_semestre)/2*100)/100,$scope.eleventh_annual_average=Math.round((promedio_undecimo_primer_semestre+promedio_undecimo_segundo_semestre)/2*100)/100},$scope.matricular=function(){var estudiantes=$scope.estudiantes;angular.forEach(estudiantes,function(estudiante){estudiante.admitido&&Estudiantes.update({estudianteId:estudiante._id},estudiante).$promise.then(function(estudiante){location.reload()})})},$scope.trasladar=function(){var estudiantes=$scope.estudiantes;angular.forEach(estudiantes,function(estudiante){estudiante.traladado&&(estudiante.fecha_traladado=(new Date).getDate(),Estudiantes.update({estudianteId:estudiante._id},estudiante).$promise.then(function(estudiante){location.reload()}))})},$scope.asignar_notas=function(){var notas=(Estudiantes.get({estudianteId:$stateParams.estudianteId}),$scope.notas);angular.forEach(notas,function(nota){for(var i=0;i<$scope.notas_decimo_undecimo.length;i++)"decimo"===nota.grado&&$scope.notas_decimo_undecimo[i].curso===nota.curso&&1===nota.semestre?nota.nota=$scope.notas_decimo_undecimo[i].nota_decimo_primer_semestre:"decimo"===nota.grado&&$scope.notas_decimo_undecimo[i].curso===nota.curso&&2===nota.semestre?nota.nota=$scope.notas_decimo_undecimo[i].nota_decimo_segundo_semestre:"undecimo"===nota.grado&&$scope.notas_decimo_undecimo[i].curso===nota.curso&&1===nota.semestre?nota.nota=$scope.notas_decimo_undecimo[i].nota_undecimo_primer_semestre:"undecimo"===nota.grado&&$scope.notas_decimo_undecimo[i].curso===nota.curso&&2===nota.semestre&&(nota.nota=$scope.notas_decimo_undecimo[i].nota_undecimo_segundo_semestre);Notas.update({notaId:nota._id},nota)}),$location.path("estudiantes/"+$stateParams.estudianteId)},$scope.subir_archivos=function(){var file=$scope.selected_certificacion_nacimiento[0];$scope.upload=$upload.upload({url:"/upload",method:"POST",file:file}).success(function(data){var estudiante=$scope.estudiante;estudiante.certificacion_nacimiento=data.name,estudiante.$update(function(){$location.path("estudiantes/"+estudiante._id)},function(errorResponse){$scope.error=errorResponse.data.message})}),file=$scope.selected_certificacion_notas[0],$scope.upload=$upload.upload({url:"/upload",method:"POST",file:file}).success(function(data){var estudiante=$scope.estudiante;estudiante.certificacion_notas=data.name,estudiante.$update(function(){$location.path("estudiantes/"+estudiante._id)},function(errorResponse){$scope.error=errorResponse.data.message})}),file=$scope.selected_inf_hogar[0],$scope.upload=$upload.upload({url:"/upload",method:"POST",file:file}).success(function(data){var estudiante=$scope.estudiante;estudiante.informe_hogar=data.name,estudiante.$update(function(){$location.path("estudiantes/"+estudiante._id)},function(errorResponse){$scope.error=errorResponse.data.message})}),file=$scope.selected_vacunas[0],$scope.upload=$upload.upload({url:"/upload",method:"POST",file:file}).success(function(data){var estudiante=$scope.estudiante;estudiante.tarjeta_vacunas=data.name,estudiante.$update(function(){location.reload()},function(errorResponse){$scope.error=errorResponse.data.message})})},$scope.init_generaciones=function(){$scope.estudiantes=Estudiantes.query()},$scope.column="",$scope.filterOptions={filterText:"",useExternalFilter:!1},$scope.gridOptionsGeneracion={data:"estudiantes",enableCellSelection:!0,enableRowSelection:!1,enableCellEditOnFocus:!1,columnDefs:[{field:"name",displayName:"Nombre"},{field:"primer_apellido",displayName:"Primer Apellido"},{field:"segundo_apellido",displayName:"Segundo Apellido"},{field:"nacionalidad",displayName:"Cédula"},{field:"graduado",displayName:"Graduado",cellTemplate:'<div class="ngCellText">{{row.getProperty(col.field) | true_false}}</div>'},{field:"colegio_procedencia",displayName:"Colegio de Procedencia"},{field:"anno_ingreso",displayName:"Año de ingreso"},{field:"sexo",displayName:"Sexo",cellTemplate:'<div class="ngCellText">{{row.getProperty(col.field) | sexo}}</div>'},{field:"traladado",displayName:"Trasladado",cellTemplate:'<div class="ngCellText">{{row.getProperty(col.field) | true_false}}</div>'},{field:"graduado",displayName:"Graduado",cellTemplate:'<div class="ngCellText">{{row.getProperty(col.field) | true_false}}</div>'},{field:"_id",displayName:"Ver",cellTemplate:'<a data-ng-href="#!/estudiantes/{{row.entity._id}}">ver</a>'}],filterOptions:$scope.filterOptions},$scope.filterOptions.filterText="",$scope.$watchCollection("[filteringText, consulta_sexo, consulta_grado, consulta_estado]",function(values){var searchQuery="";""===values[0]?$scope.filterOptions.filterText="":values[0]&&("Nombre"===$scope.consulta.nombre?searchQuery="name: "+values[0]+";":"Cedula"===$scope.consulta.nombre?searchQuery="nacionalidad: "+values[0]+";":"Colegio de Procedencia"===$scope.consulta.nombre?searchQuery="colegio_procedencia: "+values[0]+";":"Trasladado"===$scope.consulta.nombre&&(searchQuery="traladado: true;")),values[1]&&("Masculino"===$scope.consulta_sexo.sexo?searchQuery=searchQuery+"sexo: "+!0+";":"Femenino"===$scope.consulta_sexo.sexo&&(searchQuery=searchQuery+"sexo: "+!1+";")),values[2]&&(searchQuery="Décimo"===$scope.consulta_grado.grado?searchQuery+"anno_ingreso: "+(new Date).getFullYear()+";":"Undécimo"===$scope.consulta_grado.grado?searchQuery+"anno_ingreso: "+((new Date).getFullYear()-1)+";":searchQuery+"anno_ingreso: "+((new Date).getFullYear()-1)+"|"+(new Date).getFullYear()+";"),values[3]&&("Egresado"===$scope.consulta_estado.estado?searchQuery=searchQuery+"graduado: "+!0+";":"Trasladado"===$scope.consulta_estado.estado&&(searchQuery=searchQuery+"traladado: "+!0+";")),$scope.filterOptions.filterText=searchQuery}),$scope.get_all_students=function(){$scope.estudiantes=Estudiantes.query()},$scope.lista_reportes=Reports.getReportsList(),$scope.grade_reports_list=Reports.getGradesList(),$scope.reporte=$scope.lista_reportes[0],$scope.grade_report=$scope.grade_reports_list[0],$scope.ced_estudiante="",$scope.visibl=!1,$scope.$watch("ced_estudiante",function(ced_estudiante){$scope.show=!0,$scope.reporte_notas()}),$scope.$watch("reporte",function(){createReport()}),$scope.$watch("grade_report",function(){createReport()}),$scope.show=!1,$scope.base64=$sce.trustAsResourceUrl(""),$scope.nombre_reporte_notas_undecimo="",$scope.nombre_reporte_notas_decimo="",$scope.generatePDF=function(PDFReport){var doc=new jsPDF("p","pt"),logo_img=document.getElementById("cc-logo"),img_data=getBase64Image(logo_img);doc.addImage(img_data,"JPEG",15,15,25,25),doc.text(40,19,PDFReport.Header),doc.text(15,80,PDFReport.Title),doc.autoTable(PDFReport.Columns,PDFReport.Data,{margins:{right:10,left:10,top:100,bottom:100},startY:PDFReport.StartY}),$scope.base64=$sce.trustAsResourceUrl("data:application/pdf;base64,"+btoa(doc.output()))},$scope.reporte_notas=function(){if(void 0!==$scope.ced_estudiante&&""!==$scope.ced_estudiante){var serviceReport=Reports;serviceReport.studentNotes=GetNotas.query({cedula_estudiante:$scope.ced_estudiante}),serviceReport.studentNotes.$promise.then(function(notes){var pdfReport;$scope.estudiante=Nacionalidad.query({cedula:$scope.ced_estudiante}),$scope.estudiante.$promise.then(function(student){if(void 0!==student[0]){fixInvalidCharactersfixInvalidCharacters(notes),pdfReport=serviceReport.notesReport(notes,student);var doc=new jsPDF("p","pt");doc.setFontSize(16);var logo_img=document.getElementById("cc-logo"),img_data=getBase64Image(logo_img);doc.addImage(img_data,"JPEG",15,15,25,25);var infoestudiante="Cedula: "+student[0].nacionalidad+"\nNombre del Alumno: "+student[0].segundo_apellido+" "+student[0].primer_apellido+" "+student[0].name;doc.text(40,19,pdfReport.Header),doc.text(120,60,pdfReport.Title+" Decimo "+student[0].anno_ingreso),doc.text(15,90,infoestudiante),doc.setFontSize(10),doc.text(327,140,"Ausencias I Semestre              Ausencias II Semestre"),doc.autoTable(pdfReport.Columns,pdfReport.Data[0],{margins:{right:10,left:10,top:40,bottom:40},startY:150}),student[0].anno_ingreso<(new Date).getFullYear()&&(doc.addPage(),doc.setFontSize(16),doc.addImage(img_data,"JPEG",15,15,25,25),infoestudiante="Cédula: "+$scope.ced_estudiante+"\nNombre del Alumno: "+student[0].segundo_apellido+" "+student[0].primer_apellido+" "+student[0].name,doc.text(40,19,pdfReport.Header),doc.text(120,60,pdfReport.Title+" Undecimo "+(student[0].anno_ingreso+1)),doc.text(15,90,infoestudiante),doc.setFontSize(10),doc.text(327,140,"Ausencias I Semestre              Ausencias II Semestre"),doc.autoTable(pdfReport.Columns,pdfReport.Data[1],{margins:{right:10,left:10,top:40,bottom:40},startY:150})),$scope.base64=$sce.trustAsResourceUrl("data:application/pdf;base64,"+btoa(doc.output()))}})})}}}]).filter("true_false",function(){return function(text,length,end){return text?"Si":"No"}}).filter("sexo",function(){return function(text,length,end){return text?"Masculino":"Femenino"}}).filter("anno",function(){return function(text,length,end){return parseInt(text)===(new Date).getFullYear()-1?"Undécimo":"Décimo"}}),angular.module("estudiantes").factory("Estudiantes",["$resource",function($resource){return $resource("estudiantes/:estudianteId",{estudianteId:"@_id"},{update:{method:"PUT"}})}]),angular.module("estudiantes").factory("GetAdmitidos",["$resource",function($resource){return $resource("/admitidos/:admitido",{admitido:"@admitido"},{update:{method:"GET"}})}]),angular.module("estudiantes").factory("Notas",["$resource",function($resource){return $resource("/notas/:notaId",null,{update:{method:"PUT"},detele:{method:"DELETE"}})}]),angular.module("estudiantes").factory("GetNotas",["$resource",function($resource){return $resource("/notas/:cedula_estudiante",{cedula_estudiante:"@cedula_estudiante"},{update:{method:"GET"}})}]),angular.module("estudiantes").factory("Decimo",["$resource",function($resource){return $resource("/estudiantes_decimo/",null,{update:{method:"GET"}})}]),angular.module("estudiantes").factory("Undecimo",["$resource",function($resource){return $resource("/estudiantes_undecimo/",null,{update:{method:"GET"}})}]),angular.module("estudiantes").factory("Nacionalidad",["$resource",function($resource){return $resource("/nacionalidad/:cedula",{cedula:"@cedula"},{update:{method:"GET"}})}]),angular.module("estudiantes").factory("Reports",function(){var HEADER="",TITLE="",columns=[],data=[],report={attendanceListReport:function(estudiantes,grade_label){data=[],TITLE="                   CONTROL DE AUSENCIAS "+grade_label+" "+(new Date).getFullYear()+"\nProfesor: __________________                         Mes:________________ \nAsignatura: ________________                         A = Ausencia, T = Tardia",columns=[{title:"Cedula",key:"ced"},{title:"Nombre",key:"nom"},{title:"Del__ al __",key:"i"},{title:"Del__ al __",key:"ii"},{title:"Del__ al __",key:"iii"},{title:"Del__ al __",key:"iiii"}];var women=0,men=0;angular.forEach(estudiantes,function(estudiante_decimo){estudiante_decimo.admitido&&!estudiante_decimo.traladado&&(estudiante_decimo.sexo===!0?men++:women+=1,data.push({ced:estudiante_decimo.nacionalidad,nom:estudiante_decimo.segundo_apellido+" "+estudiante_decimo.primer_apellido+" "+estudiante_decimo.name,i:"",ii:"",iii:"",iiii:""}))});var total=women+men;HEADER=this.initHeader(women,men,total);var result=this.getJSONFromData(HEADER,TITLE,columns,data,130);return result},personalInfoListReport:function(estudiantes){data=[],TITLE=[],HEADER="Colegio Cientifico de Costa Rica\nInstituto Tecnologico de Costa Rica, Sede Regional San Carlos\nTelefax: 2475-7089,Tel: 2401-3122\n",columns=[{title:"Cedula",key:"ced"},{title:"I Apellido",key:"i"},{title:"II Apellido",key:"ii"},{title:"Nombre",key:"nom"},{title:"Telefono",key:"tel"},{title:"E-mail",key:"mail"}],angular.forEach(estudiantes,function(estudiante_decimo){estudiante_decimo.admitido&&!estudiante_decimo.traladado&&data.push({ced:estudiante_decimo.nacionalidad,i:estudiante_decimo.primer_apellido,ii:estudiante_decimo.segundo_apellido,nom:estudiante_decimo.name,tel:estudiante_decimo.celular,mail:estudiante_decimo.correo})});var result=this.getJSONFromData(HEADER,TITLE,columns,data,70);return result},scienceForBachelorListReport:function(estudiantes,grade_label){data=[],TITLE="      LISTA CIENCIA PARA BACHILLERATO "+grade_label+" "+(new Date).getFullYear()+"\n",columns=[{title:"Cedula",key:"ced"},{title:"Nombre",key:"nom"},{title:"Ciencia",key:"cie"},{title:"Firma",key:"fir"}];var women=0,men=0;angular.forEach(estudiantes,function(estudiante_decimo){estudiante_decimo.admitido&&!estudiante_decimo.traladado&&(estudiante_decimo.sexo===!0?men++:women+=1,data.push({ced:estudiante_decimo.nacionalidad,nom:estudiante_decimo.segundo_apellido+" "+estudiante_decimo.primer_apellido+" "+estudiante_decimo.name,cie:"",fir:""}))});var total=women+men;HEADER=this.initHeader(women,men,total);var result=this.getJSONFromData(HEADER,TITLE,columns,data,95);return result},emailListReport:function(estudiantes){data=[],HEADER="Colegio Cientifico de Costa Rica\nInstituto Tecnologico de Costa Rica, Sede Regional San Carlos\nTelefax: 2475-7089,Tel: 2401-3122\n",TITLE="",columns=[{title:"Cedula",key:"ced"},{title:"Nombre",key:"nom"},{title:"E-mail",key:"mail"}],angular.forEach(estudiantes,function(estudiante_decimo){estudiante_decimo.admitido&&!estudiante_decimo.traladado&&data.push({ced:estudiante_decimo.nacionalidad,nom:estudiante_decimo.segundo_apellido+" "+estudiante_decimo.primer_apellido+" "+estudiante_decimo.name,mail:estudiante_decimo.correo})});var result=this.getJSONFromData(HEADER,TITLE,columns,data,70);return result},scienceForBachelorChoiceListReport:function(estudiantes){data=[],TITLE="\n              ESCOGENCIA DE CIENCIA BACHILLERATO "+(new Date).getFullYear()+"\n\nProfesores:\nAsignaturas:",columns=[{title:"Cedula",key:"ced"},{title:"Nombre",key:"nom"},{title:"Biologia",key:"bio"},{title:"Quimica",key:"quim"},{title:"Fisica",key:"fis"}];var women=0,men=0;angular.forEach(estudiantes,function(estudiante_undecimo){estudiante_undecimo.admitido&&!estudiante_undecimo.traladado&&(estudiante_undecimo.sexo===!0?men++:women++,data.push({ced:estudiante_undecimo.nacionalidad,nom:estudiante_undecimo.segundo_apellido+" "+estudiante_undecimo.primer_apellido+" "+estudiante_undecimo.name,bio:"",quim:"",fis:""}))});var total=women+men;HEADER=this.initHeader(women,men,total);var result=this.getJSONFromData(HEADER,TITLE,columns,data,165);return result},StudentsForLibraryListReport:function(estudiantes,grade_label){data=[],TITLE="       LISTA DE INFORMACION PARA LA BIBLIOTECA "+grade_label+" "+(new Date).getFullYear()+"\n",columns=[{title:"Cedula",key:"ced"},{title:"Nombre",key:"nom"},{title:"Email",key:"email"},{title:"Direccion",key:"dir"},{title:"Fecha de nacimiento",key:"nac"},{title:"Edad",key:"edad"}];var women=0,men=0;angular.forEach(estudiantes,function(estudiante_decimo){if(estudiante_decimo.admitido&&!estudiante_decimo.traladado){estudiante_decimo.sexo===!0?men++:women+=1;var fecha_split=estudiante_decimo.fecha_de_nacimiento.split("-"),f=new Date;f=4===fecha_split[2].length?new Date(fecha_split[2],fecha_split[1],fecha_split[0]):new Date(fecha_split[0],fecha_split[1],fecha_split[2]);var edad=(new Date).getFullYear()-f.getFullYear();data.push({ced:estudiante_decimo.nacionalidad,nom:estudiante_decimo.segundo_apellido+" "+estudiante_decimo.primer_apellido+" "+estudiante_decimo.name,email:estudiante_decimo.correo,dir:estudiante_decimo.direccion_exacta,nac:estudiante_decimo.fecha_de_nacimiento,edad:edad})}});var total=women+men;HEADER=this.initHeader(women,men,total);var result=this.getJSONFromData(HEADER,TITLE,columns,data,95);return result},OlympicsParticipationListReport:function(estudiantes,grade_label){data=[],TITLE="\n              LISTA INTERESADOS OLIMPIADA "+grade_label+" "+(new Date).getFullYear()+"\n\nProfesores:\nAsignaturas:",columns=[{title:"Cedula",key:"ced"},{title:"Nombre",key:"nom"},{title:"Participacion Olimpiada",key:"par"}];var women=0,men=0;angular.forEach(estudiantes,function(estudiante_decimo){estudiante_decimo.admitido&&!estudiante_decimo.traladado&&(estudiante_decimo.sexo===!0?men++:women+=1,data.push({ced:estudiante_decimo.nacionalidad,nom:estudiante_decimo.segundo_apellido+" "+estudiante_decimo.primer_apellido+" "+estudiante_decimo.name,par:""}))});var total=women+men;HEADER=this.initHeader(women,men,total);var result=this.getJSONFromData(HEADER,TITLE,columns,data,165);return result},notesReport:function(student_notes,student){HEADER="Colegio Cientifico de Costa Rica\nSede San Carlos",TITLE="Informe Provisional de Calificaciones";var notes=[{curso:"Espanol",nota:0,semestre:1},{curso:"Matematicas",nota:0,semestre:1},{curso:"Fisica",nota:0,semestre:1},{curso:"Quimica",nota:0,semestre:1},{curso:"Biologia",nota:0,semestre:1},{curso:"Bioteclogia",nota:0,semestre:1},{curso:"Computacion",nota:0,semestre:1},{curso:"Robotica",nota:0,semestre:1},{curso:"Dibujo Tecnico",nota:0,semestre:1},{curso:"Ingles",nota:0,semestre:1},{curso:"Investigacion",nota:0,semestre:1},{curso:"Historia",nota:0,semestre:1},{curso:"Geografia",nota:0,semestre:1},{curso:"Educ. Religiosa",nota:0,semestre:1},{curso:"Educ. Civica",nota:0,semestre:1},{curso:"Educ. Fisica",nota:0,semestre:1},{curso:"Matematica(PROF.)",nota:0,semestre:1},{curso:"Fisica(PROF.)",nota:0,semestre:1},{curso:"Quimica(PROF.)",nota:0,semestre:1},{curso:"Biologia(PROF.)",nota:0,semestre:1},{curso:"Conducta",nota:0,semestre:1},{curso:"Promedio",nota:0,semestre:1}];columns=[{title:"Asignatura",key:"asig"},{title:"  I  ",key:"i"},{title:"  II  ",key:"ii"},{title:"PROM.",key:"prom"},{title:"M",key:"m"},{title:"I",key:"iii"},{title:"T",key:"t"},{title:"M",key:"m2"},{title:"I",key:"iii2"},{title:"T",key:"t2"}];var tenthGradeData=[],eleventhGradeData=[];angular.forEach(notes,function(curso){for(var classNoteTenthGrade=[],i=0;i<student_notes.length;i++)if(student_notes[i].curso===curso.curso&&student_notes[i].anno===(new Date).getFullYear()?classNoteTenthGrade.push(student_notes[i]):student_notes[i].curso===curso.curso&&student_notes[i].anno===(new Date).getFullYear()-1&&classNoteTenthGrade.push(student_notes[i]),2===classNoteTenthGrade.length){var c=classNoteTenthGrade[0].curso,s1=classNoteTenthGrade[0].nota,s2=classNoteTenthGrade[1].nota,p=(classNoteTenthGrade[0].nota+classNoteTenthGrade[1].nota)/2;tenthGradeData.push({asig:c,i:s1,ii:s2,prom:p,m:"",iii:"",t:"",m2:"",iii2:"",t2:""});break}}),student[0].anno_ingreso<(new Date).getFullYear()&&angular.forEach(notes,function(curso){for(var classNoteEleventhGrade=[],i=0;i<student_notes.length;i++)if(student_notes[i].curso===curso.curso&&student_notes[i].anno===(new Date).getFullYear()&&classNoteEleventhGrade.push(student_notes[i]),2===classNoteEleventhGrade.length){var c=classNoteEleventhGrade[0].curso,s1=classNoteEleventhGrade[0].nota,s2=classNoteEleventhGrade[1].nota,p=(classNoteEleventhGrade[0].nota+classNoteEleventhGrade[1].nota)/2;eleventhGradeData.push({asig:c,i:s1,ii:s2,prom:p,m:"",iii:"",t:"",m2:"",iii2:"",t2:""});break}});var pdfResultDecimo=this.getJSONFromData(HEADER,TITLE,columns,[tenthGradeData,eleventhGradeData],150);return pdfResultDecimo},getReportsList:function(){var lista=[{nombre:"Lista de asistencia",val:1},{nombre:"Lista de cedula, carne, apellidos, nombre, telefono, correo",val:2},{nombre:"Lista de ciencia para bachillerato",val:3},{nombre:"Lista de correos",val:4},{nombre:"Lista de escogencia de la ciencia para bachillerato",val:5},{nombre:"Lista para la biblioteca",val:6},{nombre:"Lista de participacion en olimpiadas",val:7},{nombre:"Reporte de notas",val:8}];return lista},getGradesList:function(){var grades=[{grade_opt:"Decimo",grade_val:1},{grade_opt:"Undecimo",grade_val:2}];return grades},initHeader:function(women,men,total){var header="Colegio Cientifico de Costa Rica                       Mujeres: "+women+"\nSede Regional San Carlos                               Hombres: "+men+"\nTelefax: 2475-7089,Tel: 2401-3122                        Total: "+total+"\n";return header},getJSONFromData:function(header,title,columns,data,startY){return{Header:header,Title:title,Columns:columns,Data:data,StartY:startY}}};return report}),angular.module("logros-academicos").config(["$stateProvider",function($stateProvider){$stateProvider.state("listLogrosAcademicos",{url:"/logros-academicos/:estudianteId/:cedulaEstudiante",templateUrl:"modules/logros-academicos/views/list-logros-academicos.client.view.html"}).state("createLogrosAcademico",{url:"/logros-academicos/create/:estudianteId/:cedulaEstudiante",templateUrl:"modules/logros-academicos/views/create-logros-academico.client.view.html"}).state("viewLogrosAcademico",{url:"/logros-academicos/:estudianteId/:cedulaEstudiante/:logrosAcademicoId",templateUrl:"modules/logros-academicos/views/view-logros-academico.client.view.html"}).state("editLogrosAcademico",{url:"/logros-academicos/:estudianteId/:cedulaEstudiante/:logrosAcademicoId/edit",templateUrl:"modules/logros-academicos/views/edit-logros-academico.client.view.html"})}]),angular.module("logros-academicos").controller("LogrosAcademicosController",["$scope","$stateParams","$location","Authentication","LogrosAcademicos","GetLogro",function($scope,$stateParams,$location,Authentication,LogrosAcademicos,GetLogro){$scope.authentication=Authentication,$scope.name="",$scope.estudiante="",$scope.descripcion="",$scope.premio="",$scope.create=function(){var logrosAcademico=new LogrosAcademicos({name:$scope.name,estudiante:$stateParams.cedulaEstudiante,descripcion:$scope.descripcion,premio:$scope.premio,anno:(new Date).getFullYear()});logrosAcademico.$save(function(response){$location.path("estudiantes/"+$stateParams.estudianteId),$scope.name=""},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(logrosAcademico){if(logrosAcademico){logrosAcademico.$remove();for(var i in $scope.logrosAcademicos)$scope.logrosAcademicos[i]===logrosAcademico&&$scope.logrosAcademicos.splice(i,1)}else $scope.logrosAcademico.$remove(function(){$location.path("logros-academicos/"+$stateParams.estudianteId+"/"+$stateParams.cedulaEstudiante)})},$scope.update=function(){var logrosAcademico=$scope.logrosAcademico;logrosAcademico.$update(function(){$location.path("logros-academicos/"+$stateParams.estudianteId+"/"+$stateParams.cedulaEstudiante+"/"+logrosAcademico._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){$scope.logrosAcademicos=LogrosAcademicos.query()},$scope.findOne=function(){$scope.cedulaEstudianteUrl=$stateParams.cedulaEstudiante,$scope.idEstudianteUrl=$stateParams.estudianteId,$scope.logrosAcademico=LogrosAcademicos.get({logrosAcademicoId:$stateParams.logrosAcademicoId})},$scope.findByEstudiante=function(){$scope.cedula=$stateParams.cedulaEstudiante,$scope.estudianteID=$stateParams.estudianteId,$scope.logrosAcademicosE=GetLogro.query({cedula:$scope.cedula})}}]),angular.module("logros-academicos").factory("LogrosAcademicos",["$resource",function($resource){return $resource("logros-academicos/:logrosAcademicoId",{logrosAcademicoId:"@_id"},{update:{method:"PUT"}})}]),angular.module("logros-academicos").factory("GetLogro",["$resource",function($resource){return $resource("/logros-academicos/estudiante/:cedula",{cedula:"@cedula"},{update:{method:"GET"}})}]),angular.module("notas").config(["$stateProvider",function($stateProvider){$stateProvider.state("listNotas",{url:"/notas",templateUrl:"modules/notas/views/list-notas.client.view.html"}).state("createNota",{url:"/notas/create",templateUrl:"modules/notas/views/create-nota.client.view.html"}).state("viewNota",{url:"/notas/:cedula_estudiante",templateUrl:"modules/notas/views/view-nota.client.view.html"}).state("editNota",{url:"/notas/:cedula_estudiante/edit",templateUrl:"modules/notas/views/edit-nota.client.view.html"})}]),angular.module("notas").controller("NotasController",["$scope","$stateParams","$location","Authentication","Notas",function($scope,$stateParams,$location,Authentication,Notas){
$scope.authentication=Authentication,$scope.create=function(){var nota=new Notas({cedula_estudiante:this.cedula_estudiante,grado:this.grado,curso:this.curso,nota:this.nota,anno:this.nota,semestre:this.semestre});nota.$save(function(response){$location.path("notas/"+response._id),$scope.name=""},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(nota){if(nota){nota.$remove();for(var i in $scope.notas)$scope.notas[i]===nota&&$scope.notas.splice(i,1)}else $scope.nota.$remove(function(){$location.path("notas")})},$scope.update=function(){var nota=$scope.nota;nota.$update(function(){$location.path("notas/"+nota._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){$scope.notas=Notas.query()},$scope.findOne=function(){$scope.nota=Notas.query({cedula_estudiante:$stateParams.cedula_estudiante}).$promise.then(function(data){console.log(data[0])}),console.log($scope.nota)}}]),angular.module("users").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["$q","$location","Authentication",function($q,$location,Authentication){return{responseError:function(rejection){switch(rejection.status){case 401:Authentication.user=null,$location.path("signin");break;case 403:}return $q.reject(rejection)}}}])}]),angular.module("users").config(["$stateProvider",function($stateProvider){$stateProvider.state("profile",{url:"/settings/profile",templateUrl:"modules/users/views/settings/edit-profile.client.view.html"}).state("password",{url:"/settings/password",templateUrl:"modules/users/views/settings/change-password.client.view.html"}).state("accounts",{url:"/settings/accounts",templateUrl:"modules/users/views/settings/social-accounts.client.view.html"}).state("signup",{url:"/signup",templateUrl:"modules/users/views/authentication/signup.client.view.html"}).state("signin",{url:"/signin",templateUrl:"modules/users/views/authentication/signin.client.view.html"}).state("forgot",{url:"/password/forgot",templateUrl:"modules/users/views/password/forgot-password.client.view.html"}).state("reset-invalid",{url:"/password/reset/invalid",templateUrl:"modules/users/views/password/reset-password-invalid.client.view.html"}).state("reset-success",{url:"/password/reset/success",templateUrl:"modules/users/views/password/reset-password-success.client.view.html"}).state("reset",{url:"/password/reset/:token",templateUrl:"modules/users/views/password/reset-password.client.view.html"})}]),angular.module("users").controller("AuthenticationController",["$scope","$http","$location","Authentication",function($scope,$http,$location,Authentication){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/"),$scope.signup=function(){$http.post("/auth/signup",$scope.credentials).success(function(response){$scope.authentication.user=response,$location.path("/")}).error(function(response){$scope.error=response.message})},$scope.signin=function(){$http.post("/auth/signin",$scope.credentials).success(function(response){$scope.authentication.user=response,$location.path("/")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("PasswordController",["$scope","$stateParams","$http","$location","Authentication",function($scope,$stateParams,$http,$location,Authentication){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/"),$scope.askForPasswordReset=function(){$scope.success=$scope.error=null,$http.post("/auth/forgot",$scope.credentials).success(function(response){$scope.credentials=null,$scope.success=response.message}).error(function(response){$scope.credentials=null,$scope.error=response.message})},$scope.resetUserPassword=function(){$scope.success=$scope.error=null,$http.post("/auth/reset/"+$stateParams.token,$scope.passwordDetails).success(function(response){$scope.passwordDetails=null,Authentication.user=response,$location.path("/password/reset/success")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("SettingsController",["$scope","$http","$location","Users","Authentication",function($scope,$http,$location,Users,Authentication){$scope.user=Authentication.user,$scope.user||$location.path("/"),$scope.hasConnectedAdditionalSocialAccounts=function(provider){for(var i in $scope.user.additionalProvidersData)return!0;return!1},$scope.isConnectedSocialAccount=function(provider){return $scope.user.provider===provider||$scope.user.additionalProvidersData&&$scope.user.additionalProvidersData[provider]},$scope.removeUserSocialAccount=function(provider){$scope.success=$scope.error=null,$http["delete"]("/users/accounts",{params:{provider:provider}}).success(function(response){$scope.success=!0,$scope.user=Authentication.user=response}).error(function(response){$scope.error=response.message})},$scope.updateUserProfile=function(isValid){if(isValid){$scope.success=$scope.error=null;var user=new Users($scope.user);user.$update(function(response){$scope.success=!0,Authentication.user=response},function(response){$scope.error=response.data.message})}else $scope.submitted=!0},$scope.changeUserPassword=function(){$scope.success=$scope.error=null,$http.post("/users/password",$scope.passwordDetails).success(function(response){$scope.success=!0,$scope.passwordDetails=null}).error(function(response){$scope.error=response.message})}}]),angular.module("users").factory("Authentication",[function(){var _this=this;return _this._data={user:window.user},_this._data}]),angular.module("users").factory("Users",["$resource",function($resource){return $resource("users",{},{update:{method:"PUT"}})}]);